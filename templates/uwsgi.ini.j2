# This file was generated by Ansible for {{ansible_fqdn}}
# Do NOT modify this file by hand!

{% set app = item %}
{% set run_dir = item.run_dir|default("/opt/%s/run" % item.name) -%}
{% set log_dir = item.log_dir|default("/opt/%s/log" % item.name) -%}
{% set etc_dir = item.etc_dir|default("/opt/%s/etc" % item.name) -%}
{% set env_dir = item.virtualenv|default("/opt/%s/env" % item.name) -%}
{% set app_dir = item.app_dir|default("/opt/%s/src" % item.name) -%}

[uwsgi]
chdir = {{app_dir}}
chmod-socket = 777
chown-socket = {{wsgi_user}}
die-on-term = true
enable-threads = {{ 'true' if wsgi_uwsgi_enable_threads else 'false' }}
log-master = true
logto = {{log_dir}}/{{app.name}}-wsgi.log
master = true
max-requests = {{wsgi_uwsgi_max_requests}}
no-orphans = {{ 'true' if wsgi_uwsgi_no_orphans else 'false' }}
processes = {{app.uwsgi_processes|default(wsgi_uwsgi_processes)}}
socket = {{app.socket|default(run_dir + '/' + app.name)}}
uid = {{wsgi_user}}
vaccuum = true
virtualenv = {{env_dir}}
{% if app.module|default(None) -%}
module = {{app.module|default('')}}
{% else %}
file = {{app.file|default(app_dir + '/wsgi.py')}}
{% endif %}
{% if wsgi_uwsgi_cpu_affinity is defined -%}
cpu-affinity = {{ wsgi_uwsgi_cpu_affinity }}
{% endif %}
{% if wsgi_uwsgi_limit_as is defined -%}
limit-as = {{wsgi_uwsgi_limit_as}}
{% endif %}
{% if wsgi_reload -%}
py-autoreload = true
touch-reload = {{app_dir}}
{% endif %}
{% for option in app.uwsgi_options|default(wsgi_uwsgi_options) %}
{{option}}
{% endfor -%}
